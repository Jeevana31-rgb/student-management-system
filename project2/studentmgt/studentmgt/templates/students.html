
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Student Management System - Students</title>

<style>
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family: "Segoe UI", Arial, sans-serif;
}

body{
    background:#f4f6f9;
}

/* Top Navbar */
.navbar{
    height:60px;
    background:#1f2937;
    color:white;
    display:flex;
    align-items:center;
    padding:0 30px;
    font-size:22px;
    font-weight:600;
}

/* Layout */
.wrapper{
    display:flex;
    height:calc(100vh - 60px);
}

/* Sidebar */
.sidebar{
    width:220px;
    background:#111827;
    padding-top:20px;
}

.sidebar a{
    display:block;
    padding:15px 25px;
    color:#d1d5db;
    text-decoration:none;
    font-size:16px;
}

.sidebar a:hover,
.sidebar a.active{
    background:#1f2937;
    color:white;
}

/* Main Content */
.main{
    flex:1;
    padding:30px;
}

/* Header Row */
.header-row{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:20px;
}

.header-row h1{
    font-size:28px;
}

.add-btn{
    padding:10px 18px;
    background:#2563eb;
    color:white;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-size:14px;
}

.add-btn:hover{
    background:#1d4ed8;
}

/* Table */
.table-container{
    background:white;
    border-radius:12px;
    box-shadow:0 4px 10px rgba(0,0,0,0.1);
    overflow-x:auto;
}

table{
    width:100%;
    border-collapse:collapse;
}

th, td{
    padding:14px 16px;
    text-align:left;
}

th{
    background:#f9fafb;
    color:#374151;
    font-weight:600;
    border-bottom:2px solid #e5e7eb;
}

td{
    border-bottom:1px solid #e5e7eb;
    color:#374151;
}

/* Hover Effect */
tbody tr:hover{
    background:#f1f5f9;
}

/* Action Buttons */
.action-btn{
    padding:6px 12px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    font-size:13px;
}

.edit{
    background:#22c55e;
    color:white;
}

.delete{
    background:#ef4444;
    color:white;
}

.edit:hover{background:#16a34a;}
.delete:hover{background:#dc2626;}

/* Modal / form styles */
.modal { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.4); z-index:60; }
.hidden { display:none; }
.modal-card{ background:#fff; padding:18px; border-radius:10px; width:380px; box-shadow:0 10px 30px rgba(0,0,0,0.15); color:#111; }
.modal-card h3{ margin:0 0 6px; }

/* Delete (danger) button */
.delete { background:#ef4444; color:white; padding:8px 12px; border-radius:6px; border:none; cursor:pointer; }
.delete:hover { background:#dc2626; }

/* Responsive */
@media(max-width:900px){
    th, td{
        font-size:14px;
        padding:10px;
    }
}
</style>
</head>

<body>

<!-- Top Navigation -->
<div class="navbar">
    Student Management System
</div>

<div class="wrapper">

    <!-- Sidebar -->
    <div class="sidebar">
        <a href="{% url 'dashboard' %}">üìä Dashboard</a>
        <a href="{% url 'students_list' %}" class="active">üë®‚Äçüéì Students</a>
        <a href="{% url 'courses_list' %}" id="nav-courses">üìö Courses</a>
        <a href="{% url 'logout' %}">üö™ Logout</a>
    </div>

    <!-- Main Content -->
    <div class="main">

        <!-- Header -->
        <div class="header-row">
            <h1>Student List</h1>
            <a href="{% url 'add_student' %}" id="add-student-btn" class="add-btn">‚ûï Add Student</a>
        </div>

        <!-- Table -->
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Student Name</th>
                        <th>Email</th>
                        <th>Age</th>
                        <th>Course</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="students-tbody">
                    {% for student in students %}
                    <tr data-id="{{ student.id }}">
                        <td>{{ student.name }}</td>
                        <td>{{ student.email }}</td>
                        <td>{{ student.age }}</td>
                        <td>{{ student.course.name }}</td>
                        <td>
                            <a href="{% url 'edit_student' student.id %}" class="action-btn edit">Edit</a>
                            <button class="action-btn delete delete-btn" data-id="{{ student.id }}">Delete</button>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" style="text-align:center;">No students found. <a href="{% url 'add_student' %}">Add a student</a></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- DELETE CONFIRMATION MODAL -->
        <div id="confirm-delete-modal" class="modal hidden" aria-hidden="true">
            <div class="modal-card">
                <h3>Confirm delete</h3>
                <p style="margin-top:8px">Are you sure you want to delete this student?</p>
                <div style="display:flex;gap:10px;margin-top:14px;justify-content:flex-end">
                    <button id="cancel-delete-btn" class="action-btn" style="background:#9ca3af;color:#fff">Cancel</button>
                    <button id="confirm-delete-btn" class="delete" style="background:#ef4444">Yes, Delete</button>
                </div>
            </div>
        </div>

        <!-- small top message area -->
        <div id="top-msg" style="position:fixed;top:72px;right:20px;display:none;padding:10px 14px;border-radius:8px;background:#e6fffa;color:#065f46;box-shadow:0 6px 20px rgba(0,0,0,0.06);z-index:80"></div>

    </div>
</div>

<script>
// Student list logic (updated to use Django backend)
(function(){
    const tbody = document.getElementById('students-tbody');
    const confirmModal = document.getElementById('confirm-delete-modal');
    const confirmBtn = document.getElementById('confirm-delete-btn');
    const cancelBtn = document.getElementById('cancel-delete-btn');
    const topMsg = document.getElementById('top-msg');

    let pendingDeleteId = null;

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    function showDeleteModal(id){
        pendingDeleteId = id;
        confirmModal.classList.remove('hidden');
        confirmModal.setAttribute('aria-hidden','false');
    }
    
    function hideDeleteModal(){
        pendingDeleteId = null;
        confirmModal.classList.add('hidden');
        confirmModal.setAttribute('aria-hidden','true');
    }

    function showTopMsg(text, timeout=1500){
        topMsg.textContent = text;
        topMsg.style.display = 'block';
        setTimeout(()=> topMsg.style.display = 'none', timeout);
    }

    tbody.addEventListener('click', function(e){
        const del = e.target.closest('.delete-btn');
        if (del) {
            const id = Number(del.getAttribute('data-id'));
            showDeleteModal(id);
            return;
        }
    });

    confirmBtn.addEventListener('click', function(){
        if (pendingDeleteId == null) return hideDeleteModal();
        
        const csrftoken = getCookie('csrftoken');
        fetch(`/students/delete/${pendingDeleteId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrftoken,
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Remove the row from table
                const row = tbody.querySelector(`tr[data-id="${pendingDeleteId}"]`);
                if (row) row.remove();
                hideDeleteModal();
                showTopMsg(data.message || 'Student deleted.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            hideDeleteModal();
        });
    });

    cancelBtn.addEventListener('click', hideDeleteModal);
})();
</script>

</body>
</html>
