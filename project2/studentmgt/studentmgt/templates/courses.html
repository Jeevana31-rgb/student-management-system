
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Student Management System - Courses</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"Segoe UI",Arial,sans-serif}
body{background:#f4f6f9}
.navbar{height:60px;background:#1f2937;color:white;display:flex;align-items:center;padding:0 30px;font-size:22px;font-weight:600}
.wrapper{display:flex;height:calc(100vh - 60px)}
.sidebar{width:220px;background:#111827;padding-top:20px}
.sidebar a{display:block;padding:15px 25px;color:#d1d5db;text-decoration:none;font-size:16px}
.sidebar a:hover,.sidebar a.active{background:#1f2937;color:white}
.main{flex:1;padding:30px}
.header-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.header-row h1{font-size:28px}
.add-btn{padding:10px 18px;background:#2563eb;color:white;border:none;border-radius:8px;cursor:pointer;font-size:14px}
.add-btn:hover{background:#1d4ed8}
/* Table */
.table-container{background:white;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.1);overflow-x:auto}
table{width:100%;border-collapse:collapse}
th,td{padding:14px 16px;text-align:left}
th{background:#f9fafb;color:#374151;font-weight:600;border-bottom:2px solid #e5e7eb}
td{border-bottom:1px solid #e5e7eb;color:#374151}
tbody tr:hover{background:#f1f5f9}
.action-btn{padding:6px 12px;border:none;border-radius:6px;cursor:pointer;font-size:13px}
.delete{background:#ef4444;color:white}
.delete:hover{background:#dc2626}
.edit{background:#22c55e;color:white}
.edit:hover{background:#16a34a}

/* Modal */
.modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.4);z-index:60}
.hidden{display:none}
.modal-card{background:#fff;padding:18px;border-radius:10px;width:360px;box-shadow:0 10px 30px rgba(0,0,0,0.15);color:#111}
.modal-card h3{margin:0 0 8px}
.modal-card input{width:100%;padding:10px;margin:8px 0;border:1px solid #e5e7eb;border-radius:8px}
.form-msg{display:none;font-size:13px;padding:8px;border-radius:8px;margin-bottom:6px}
.form-msg.error{background:#ffecec;color:#7f1d1d;display:block}
.form-msg.success{background:#e6fffa;color:#065f46;display:block}

/* top toast */
.top-msg{position:fixed;top:72px;right:20px;display:none;padding:10px 14px;border-radius:8px;background:#e6fffa;color:#065f46;box-shadow:0 6px 20px rgba(0,0,0,0.06);z-index:80}
@media(max-width:900px){th,td{font-size:14px;padding:10px}}
</style>
</head>
<body>

<div class="navbar">Student Management System</div>

<div class="wrapper">
    <div class="sidebar">
        <a href="{% url 'dashboard' %}">üìä Dashboard</a>
        <a href="{% url 'students_list' %}">üë®‚Äçüéì Students</a>
        <a href="{% url 'courses_list' %}" class="active">üìö Courses</a>
        <a href="{% url 'logout' %}">üö™ Logout</a>
    </div>

    <div class="main">
        <div class="header-row">
            <h1>Courses</h1>
            <button id="add-course-btn" class="add-btn">‚ûï Add Course</button>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Course Name</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="courses-tbody">
                    {% for course in courses %}
                    <tr data-id="{{ course.id }}">
                        <td>{{ course.name }}</td>
                        <td>
                            <button class="action-btn delete-btn delete" data-id="{{ course.id }}">Delete</button>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="2" style="text-align:center;">No courses found. Add a course using the button above.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Add Course Modal -->
<div id="course-modal" class="modal hidden" aria-hidden="true">
    <div class="modal-card">
        <h3 id="modal-title">Add Course</h3>
        <div id="form-msg" class="form-msg" role="status" aria-live="polite"></div>
        <input id="course-name" type="text" placeholder="Course Name" autofocus>
        <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:10px">
            <button id="cancel-course-btn" class="action-btn" style="background:#9ca3af;color:white">Cancel</button>
            <button id="save-course-btn" class="add-btn">Save</button>
        </div>
    </div>
</div>

<!-- Delete confirmation modal -->
<div id="confirm-delete-modal" class="modal hidden" aria-hidden="true">
    <div class="modal-card">
        <h3>Confirm delete</h3>
        <p style="margin-top:8px">Are you sure you want to delete this course?</p>
        <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:14px">
            <button id="cancel-delete-btn" class="action-btn" style="background:#9ca3af;color:#fff">Cancel</button>
            <button id="confirm-delete-btn" class="delete">Yes, Delete</button>
        </div>
    </div>
</div>

<div id="top-msg" class="top-msg"></div>

<script>
(function(){
    const tbody = document.getElementById('courses-tbody');
    const addBtn = document.getElementById('add-course-btn');
    const modal = document.getElementById('course-modal');
    const modalTitle = document.getElementById('modal-title');
    const formMsg = document.getElementById('form-msg');
    const courseNameEl = document.getElementById('course-name');
    const saveBtn = document.getElementById('save-course-btn');
    const cancelBtn = document.getElementById('cancel-course-btn');

    const confirmModal = document.getElementById('confirm-delete-modal');
    const confirmBtn = document.getElementById('confirm-delete-btn');
    const cancelDeleteBtn = document.getElementById('cancel-delete-btn');

    const topMsg = document.getElementById('top-msg');

    let pendingDeleteId = null;

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    function showModal(){
        formMsg.className = 'form-msg';
        formMsg.textContent = '';
        modalTitle.textContent = 'Add Course';
        courseNameEl.value = '';
        modal.classList.remove('hidden');
        modal.setAttribute('aria-hidden','false');
        courseNameEl.focus();
    }

    function closeModal(){ 
        modal.classList.add('hidden'); 
        modal.setAttribute('aria-hidden','true'); 
    }

    function showFormMsg(text,type='error'){ 
        formMsg.textContent = text; 
        formMsg.className = 'form-msg ' + type; 
    }

    function showTopMsg(text, timeout=1400){
        topMsg.textContent = text; 
        topMsg.style.display = 'block';
        setTimeout(()=> topMsg.style.display = 'none', timeout);
    }

    function addCourse(){
        const name = courseNameEl.value.trim();
        if (!name) return showFormMsg('Course name is required.','error');
        
        const csrftoken = getCookie('csrftoken');
        fetch('/courses/add/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrftoken,
                'X-Requested-With': 'XMLHttpRequest'
            },
            body: JSON.stringify({ name: name })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Reload page to show new course
                location.reload();
            } else {
                showFormMsg(data.message || 'Failed to add course', 'error');
            }
        })
        .catch(error => {
            showFormMsg('An error occurred', 'error');
        });
    }

    // delete flow with confirmation
    function showDeleteModal(id){
        pendingDeleteId = id;
        confirmModal.classList.remove('hidden');
        confirmModal.setAttribute('aria-hidden','false');
    }
    
    function hideDeleteModal(){ 
        pendingDeleteId = null; 
        confirmModal.classList.add('hidden'); 
        confirmModal.setAttribute('aria-hidden','true'); 
    }
    
    function confirmDelete(){
        if (pendingDeleteId == null) return hideDeleteModal();
        
        const csrftoken = getCookie('csrftoken');
        fetch(`/courses/delete/${pendingDeleteId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrftoken,
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Remove the row from table
                const row = tbody.querySelector(`tr[data-id="${pendingDeleteId}"]`);
                if (row) row.remove();
                hideDeleteModal();
                showTopMsg(data.message || 'Course deleted.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            hideDeleteModal();
        });
    }

    tbody.addEventListener('click', function(e){
        const del = e.target.closest('.delete-btn');
        if (del) {
            const id = Number(del.getAttribute('data-id'));
            showDeleteModal(id);
        }
    });

    addBtn.addEventListener('click', showModal);
    cancelBtn.addEventListener('click', closeModal);
    saveBtn.addEventListener('click', addCourse);

    confirmBtn.addEventListener('click', confirmDelete);
    cancelDeleteBtn.addEventListener('click', hideDeleteModal);

    window.addEventListener('keydown', function(e){ 
        if (e.key === 'Escape') { 
            closeModal(); 
            hideDeleteModal(); 
        } 
    });
})();
</script>

</body>
</html>
